<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Interactive Lathe Labeling Activity</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    #image-container { position: relative; display: inline-block; }
    #lathe-image { max-width: 100%; height: auto; }
    .hotspot {
      position: absolute;
      width: 15px;
      height: 15px;
      background: rgba(255,0,0,0.5);
      border-radius: 50%;
      cursor: pointer;
      border: 1px solid #fff;
      transition: background 0.3s;
    }
    #label-box {
      margin-top: 20px;
      padding: 10px;
      border: 1px solid #ccc;
      width: 300px;
    }
    #completion-box {
      margin-top: 20px;
      padding: 15px;
      border: 2px solid #4CAF50;
      background-color: #f0f9f0;
      display: none;
    }
  </style>
</head>
<body>
  <h1>Lathe Labeling Activity</h1>
  <p>Enter your first and last name, then click a hotspot on the lathe image and type the correct label. You have 3 attempts per part and only one chance for the activity.</p>

  <div id="student-info">
    <label>First Name: </label><input type="text" id="first-name" />
    <label>Last Name: </label><input type="text" id="last-name" />
  </div>

  <div id="image-container">
    <img id="lathe-image" src="lathe.png" alt="PM Lathe" />

    <!-- 16 Hotspots -->
    <div class="hotspot" style="top: 28%; left: 26%;" data-part="Spindle"></div>
    <div class="hotspot" style="top: 34%; left: 80%;" data-part="Tailstock"></div> 
    <div class="hotspot" style="top: 52%; left: 40%;" data-part="Cross slide handwheel"></div>
    <div class="hotspot" style="top: 39%; left: 51%;" data-part="Compound"></div> 
    <div class="hotspot" style="top: 34%; left: 12%;" data-part="Speedcontrol"></div> 
    <div class="hotspot" style="top: 25%; left: 12%;" data-part="Tachometer"></div> 
    <div class="hotspot" style="top: 56%; left: 14%;" data-part="Gearbox"></div> 
    <div class="hotspot" style="top: 43%; left: 17%;" data-part="Headstock"></div> 
    <div class="hotspot" style="top: 29%; left: 21%;" data-part="Chuck guard"></div> 
    <div class="hotspot" style="top: 28%; left: 50%;" data-part="Toolpost"></div> 
    <div class="hotspot" style="top: 22%; left: 38%;" data-part="Steady rest"></div> 
    <div class="hotspot" style="top: 34%; left: 73%;" data-part="Tailstock quill"></div>
    <div class="hotspot" style="top: 66%; left: 72%;" data-part="Leadscrew"></div> 
    <div class="hotspot" style="top: 70%; left: 51%;" data-part="Half-nut lever"></div> 
    <div class="hotspot" style="top: 60%; left: 57%;" data-part="Threading dial"></div> 
    <div class="hotspot" style="top: 62%; left: 47%;" data-part="Power feed lever"></div> 
    <div class="hotspot" style="top: 60%; left: 36%;" data-part="Carriage handwheel"></div>
  </div>

  <div id="label-box">
    <p id="selected-message"><strong>Click on a part to start.</strong></p>
    <label>Enter Label: </label>
    <input type="text" id="label-input" />
    <button onclick="submitLabel()">Submit</button>
    <p id="feedback"></p>
    <p id="score"></p>
  </div>

  <div id="completion-box"></div>

  <script>
    const hotspots = document.querySelectorAll('.hotspot');
    let activePart = null;
    let attempts = {};
    let correctParts = {};
    let completedStudents = new Set();

    function normalize(str) {
      return str.replace(/\s+/g, '').toLowerCase();
    }

    hotspots.forEach(h => {
      const part = h.dataset.part;
      attempts[part] = 0;
      correctParts[part] = false;

      h.addEventListener('click', () => {
        const firstName = document.getElementById('first-name').value.trim();
        const lastName = document.getElementById('last-name').value.trim();
        const studentKey = normalize(firstName + lastName);

        if (!firstName || !lastName) {
          alert('Please enter your first and last name.');
          return;
        }

        if (completedStudents.has(studentKey)) {
          document.getElementById('completion-box').innerHTML = '<h2>You have already completed this activity before.</h2>';
          document.getElementById('completion-box').style.display = 'block';
          return;
        }

        if (attempts[part] >= 3 || correctParts[part]) return;

        activePart = part;
        document.getElementById('selected-message').textContent = 'A part has been selected.';
        document.getElementById('feedback').textContent = '';
        document.getElementById('label-input').value = '';

        hotspots.forEach(hs => {
          if (!correctParts[hs.dataset.part] && attempts[hs.dataset.part] < 3) {
            hs.style.background = 'rgba(255,0,0,0.5)';
          }
        });
        h.style.background = 'rgba(255,255,0,0.7)';
      });
    });

    function submitLabel() {
      const firstName = document.getElementById('first-name').value.trim();
      const lastName = document.getElementById('last-name').value.trim();
      const studentKey = normalize(firstName + lastName);

      if (!firstName || !lastName) {
        alert('Please enter your first and last name.');
        return;
      }

      if (completedStudents.has(studentKey)) {
        document.getElementById('completion-box').innerHTML = '<h2>You have already completed this activity before.</h2>';
        document.getElementById('completion-box').style.display = 'block';
        return;
      }

      if (!activePart) return;
      const studentLabel = normalize(document.getElementById('label-input').value);
      const correctLabel = normalize(activePart);
      attempts[activePart]++;

      const hotspotElement = Array.from(hotspots).find(h => h.dataset.part === activePart);

      if (studentLabel === correctLabel) {
        document.getElementById('feedback').textContent = 'Correct!';
        document.getElementById('feedback').style.color = 'green';
        correctParts[activePart] = true;
        hotspotElement.style.background = 'rgba(0,128,0,0.9)';
        activePart = null;
      } else if (attempts[activePart] >= 3) {
        document.getElementById('feedback').textContent = `Incorrect. The correct answer is '${activePart}'.`;
        document.getElementById('feedback').style.color = 'red';
        hotspotElement.style.background = 'rgba(0,0,0,0.8)';
        activePart = null;
      } else {
        document.getElementById('feedback').textContent = 'Incorrect. Try again.';
        document.getElementById('feedback').style.color = 'red';
        hotspotElement.style.background = 'rgba(255,255,0,0.7)';
      }

      if (Object.values(attempts).every(a => a > 0)) {
        const totalScore = Object.values(correctParts).filter(v => v).length;
        document.getElementById('score').textContent = `Your score: ${totalScore} / ${hotspots.length}`;

        const completionBox = document.getElementById('completion-box');
        completionBox.innerHTML = `<h2>Activity Complete</h2>
                                   <p><strong>Student:</strong> ${firstName} ${lastName}</p>
                                   <p><strong>Score:</strong> ${totalScore} / ${hotspots.length}</p>
                                   <p>Take a screenshot of this box and upload it to CarmenCanvas.</p>`;
        completionBox.style.display = 'block';

        completedStudents.add(studentKey);
      }
    }
  </script>
</body>
</html>